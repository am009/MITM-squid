#ç›¸å…³ä»‹ç»:

https://wenku.baidu.com/view/aa293b50336c1eb91a375d68.html
http://blog.jobbole.com/76247/

#ä½¿ç”¨è¯´æ˜
å®‰è£…squidåä½¿ç”¨è¿™é‡Œçš„é…ç½®æ–‡ä»¶ï¼ˆ/etc/squid/squid.confï¼‰
å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„url_rewrite_programå‚æ•°åˆ°ä¸‹è½½çš„è„šæœ¬
ç›®å‰åªæœ‰ä¸¤ä¸ªè„šæœ¬å¯ç”¨ï¼Œä½ ä»¬ä¹Ÿå¯ä»¥å‚ç…§æˆ‘çš„ä¿®æ”¹ï¼Œä¸»è¦æ˜¯æ¯ä¸€è¡Œè¾“å…¥çš„è§£æï¼Œå’Œä»€ä¹ˆæ¥ç€


é¡ºå¸¦ä¿®æ”¹ä¸‹perlè„šæœ¬é‡Œifåˆ¤æ–­é‡Œçš„ä¸»æœºå

#å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜

åœ¨æ‰§è¡Œsquid -zï¼Œå¯èƒ½æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š

FATAL: Ipc::Mem::Segment::create failed to shm_open(/squid-cf__metadata.shm): (17) File exists

é’ˆå¯¹è¿™ç§é”™è¯¯ï¼Œéœ€è¦åˆ° dev/shm/ ç›®å½•ä¸‹ï¼Œå°†æ‰€æœ‰çš„æ–‡ä»¶åˆ é™¤å†é‡æ–°æ‰§è¡Œã€‚åˆ é™¤å‰ï¼Œéœ€è¦åˆ°ä»»åŠ¡ç®¡ç†å™¨ä¸­åœæ­¢squidæœåŠ¡ã€‚

æ–°ç‰ˆçš„mogrifyå¯èƒ½ä¼šæŠ¥é”™ï¼š
/etc/ImageMagick-6/policy.xml
 ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/ImageMagick-6/policy.xmlï¼Œç»™coderï¼Œpathèµ‹read,writeæƒé™
<policy domain="path" rights="read|write" pattern="@*"/>
<policy domain="coder" rights="read|write" pattern="LABEL" />


#å…¶ä»–

perlæˆ‘è¿‡æ»¤äº†æœ¬åœ°çš„è®¡ç®—æœºåï¼Œå› ä¸ºæ„Ÿè§‰ä¼šå½¢æˆæ— é™å¾ªç¯ï¼Œä¸çŸ¥é“é‡å®šå‘è‡ªå·±çš„å›¾ç‰‡ä¼šä¸ä¼šè¿˜æ˜¯å†è¿è¡Œé‡å®šå‘è„šæœ¬ã€‚ã€‚ã€‚
perlæ”¯æŒutf-8éƒ½è¿™ä¹ˆéº»çƒ¦ï¼Œå¥½æƒ³æ”¹å†™æˆpythonè„šæœ¬ã€‚ã€‚ã€‚
perlæŠ˜è…¾æ­»æˆ‘äº†ï¼Œå®ƒä½œä¸ºé‡å®šå‘è„šæœ¬æ€»æ˜¯ä¸èƒ½æ‰“å¼€æ–‡ä»¶å†™logï¼ŒğŸ˜­ã€‚ã€‚ã€‚ã€‚åªèƒ½åœ¨urlå‰é¢åŠ å­—ç¬¦ï¼Œç„¶ååœ¨è°ƒè¯•squidçš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°é‡å®šå‘çš„url

debugæ—¶å»ºè®®
ä½¿ç”¨-Né€‰é¡¹æ¥ä¿æŒsquidåœ¨å‰å°è¿è¡Œï¼Œ-d1é€‰é¡¹åœ¨æ ‡å‡†é”™è¯¯é‡Œæ˜¾ç¤º1çº§åˆ«çš„è°ƒè¯•ä¿¡æ¯ã€‚
%sudo squid -N -d1

é‡Œé¢è¿˜æœ‰ä¸€ä¸ªcache-peerçš„é€‰é¡¹ï¼Œæœ¬æ¥æƒ³å‡è£…DNSæ¬ºéª—çš„ï¼Œç»“æœåªæœ‰è®¾ç½®ä»£ç†å¯ä»¥ç”¨ï¼Œé€æ˜ä»£ç†ä¸èƒ½ç”¨ã€‚ã€‚ã€‚

ç°åœ¨çš„squidæ”¹äº†ï¼Œè€Œç½‘ä¸Šçš„æ–‡æ¡£éƒ½æ²¡æ€ä¹ˆæ”¹ï¼Œè¿˜æ˜¯å®˜æ–¹æ–‡æ¡£é è°±ï¼Œå‚æ•°åº”è¯¥ç”¨url_rewrite_programè€Œä¸æ˜¯redirect_program

è¿˜æœ‰å¹¶å‘çš„é—®é¢˜ï¼Œè™½ç„¶æ”¹æˆå¹¶å‘å®ƒè¿˜æ˜¯ç»™æˆ‘åªå¯åŠ¨ä¸€ä¸ªperlè„šæœ¬è¿›ç¨‹ï¼ˆæ˜¯ä¸æ˜¯å› ä¸ºæˆ‘çš„ï¼‰ï¼Œä¸è¿‡é€Ÿåº¦å¥½åƒå˜å¿«äº†ï¼Œè¿˜ä¸ä¼šæ¼äº†ã€‚

æ”¹æˆå¹¶å‘å°±æ˜¯url_rewrite_children 20 startup=0 idle=1 concurrency=20çš„concurrencyï¼Œè€Œä¸”è„šæœ¬çš„å‚æ•°ä¸åªæ˜¯urlï¼Œå‰é¢æœ‰ä¸€ä¸ªé€šé“åºå·ï¼Œè¦åŸæ ·è¿˜ç»™squidï¼Œæ³¨æ„æŒ‰ç…§å®˜ç½‘çš„æ–‡æ¡£å°±æ²¡æœ‰é—®é¢˜ï¼Œç°åœ¨è¿™æ–¹é¢çš„ä¸­æ–‡ç½‘é¡µåŸºæœ¬éƒ½å·²ç»è¿‡æ—¶äº†ã€‚

â€”â€”â€”â€”â€”â€”â€”â€”â€”Previous Authorsâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
Update by Weeds Qian
Email: guozhengqian0825@126.com
Blog: https://github.com/qianguozheng

Modify squid.conf to be compliant with squid3.
Add more test scripts.

â€”â€”â€”â€”â€”â€”â€”â€”â€”Previous Authorsâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
this is some files of MITM using squid to change some clients' browsers returns ;)
AND 
please wait...well, i'll upload more scripts so it can be very funny! Trust me~
